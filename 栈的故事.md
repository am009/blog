---
title: 栈的故事
date: 2019/7/31 20:46:25
categories:
- CTF
tags:
- CTF
- 栈
---

# 栈的故事

总是弄不清楚栈
总结一波

<!-- more -->
## 一
一个函数刚被调用的时候
最开始需要一个全新的栈（esp = ebp）
然后再sub esp 为局部变量拓展空间
开始干自己的事

## 二
一个函数想要调用另外一个函数
首先它要push参数
然后就可以call了

## 三
一个函数发现自己被调用，可是上一个函数的栈还是在那里，
esp下面是返回地址和几个参数
于是它自己动手，把原来的栈底打包（push ebp），
再在当前的栈上建立新栈，即栈底是原来的栈顶（move ebp <- esp）

## 四
三里的函数，它干完自己的事情了，要返回了。
首先恢复原来的esp,即让esp指向栈底（move esp <- ebp）
然后恢复栈底 （pop ebp）
最后retn返回（pop eip）

## 总结
所以，当一个函数想要调用另外一个函数，能否列举出发生了哪些事情？
1. 调用者头脑简单地push参数，call
2. 被调用者建立好自己的栈，做完事情后还原栈。


## 五

在另外一个世界里（stripped）
函数们不使用ebp相互分离
待续。。。




